# Real-ESRGAN 图像放大服务 🚀

这是一个高效的图像放大服务，通过预加载模型到内存中，实现快速批量处理图片。

## 🆚 对比原版脚本

| 特性 | 原版脚本 | 服务版本 |
|------|---------|---------|
| 模型加载 | 每次处理都要加载 (5.03s) | 启动时一次性加载 |
| 处理速度 | 5.55s/张 | ~0.5s/张 (首次后) |
| 批量处理 | 不支持 | ✅ 支持交互式批量处理 |
| 内存占用 | 低 | 高 (模型常驻内存) |

## 🎯 主要优势

1. **极速处理**: 模型预加载后，单张图片处理时间从5.55秒降至约0.5秒
2. **交互式**: 终端界面，输入图片路径即可处理
3. **批量友好**: 可连续处理多张图片，无需重复加载模型
4. **质量控制**: 支持无损压缩和90%质量两种WebP输出选项
5. **详细统计**: 实时显示处理时长和统计信息

## 🚀 使用方法

### 启动服务
```bash
python upscale_service.py
```

### 选择压缩质量
- **选项1**: 无损压缩 (文件较大，质量最佳)
- **选项2**: 90%质量 (文件适中，质量很好)

### 处理图片
1. 输入图片路径 (支持拖拽文件到终端)
2. 等待处理完成
3. 查看详细时长统计
4. 继续输入下一张图片路径

### 退出服务
输入以下任一命令：
- `quit`
- `exit` 
- `q`
- 或按 `Ctrl+C`

## 📊 性能分析

### 首次处理 (包含模型加载)
- 模型加载: ~5秒
- 图像处理: ~0.5秒
- **总计**: ~5.5秒

### 后续处理 (模型已缓存)
- 图像加载: ~0.01秒
- 图像调整: ~0.01秒  
- AI放大: ~0.37秒
- 文件保存: ~0.13秒
- **总计**: ~0.52秒

**效率提升**: 约 **10.7倍** 🎉

## 💾 WebP压缩说明

### 无损压缩 (选项1)
- 质量: 100% (完全无损)
- 文件大小: 较大
- 适用场景: 需要最高质量的场合

### 90%质量 (选项2)  
- 质量: 90% (轻微压缩)
- 文件大小: 适中
- 适用场景: 平衡质量和文件大小

## 🔧 系统要求

- Python 3.7+
- 依赖包: `torch`, `opencv-python`, `Pillow`, `basicsr`
- 内存: 建议4GB以上 (模型常驻内存)
- 处理器: 支持CPU处理

## 💡 使用技巧

1. **批量处理**: 准备好多张图片的路径，可以连续处理
2. **路径输入**: 支持拖拽文件到终端自动填入路径
3. **性能监控**: 关注处理统计，了解系统性能
4. **内存管理**: 长时间使用后可重启服务释放内存

## 🆘 常见问题

**Q: 服务启动慢怎么办？**
A: 首次启动需要加载17.9MB的模型文件，这是正常现象。

**Q: 处理大图片很慢？**
A: 图片会自动调整到512像素最大边长，超大图片会先缩放。

**Q: 内存占用高？**
A: 这是预期行为，模型常驻内存以提高处理速度。

**Q: 想要其他压缩质量？**
A: 可以修改脚本中的quality参数，或联系开发者添加更多选项。
